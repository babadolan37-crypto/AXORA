# ğŸ—ï¸ Architecture Diagram: Double-Entry System

## ğŸ“Š DATABASE SCHEMA DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DOUBLE-ENTRY ACCOUNTING SYSTEM                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ACCOUNTS      â”‚         â”‚ JOURNAL_ENTRIES  â”‚         â”‚  JOURNAL_LINES   â”‚
â”‚ (Chart of Acct)  â”‚         â”‚    (Header)      â”‚         â”‚    (Detail)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (PK)        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â€¢ id (PK)        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â€¢ id (PK)        â”‚
â”‚ â€¢ user_id (FK)   â”‚         â”‚ â€¢ user_id (FK)   â”‚         â”‚ â€¢ journal_entry  â”‚
â”‚ â€¢ code           â”‚         â”‚ â€¢ entry_number   â”‚         â”‚   _id (FK)       â”‚
â”‚ â€¢ name           â”‚         â”‚ â€¢ entry_date     â”‚         â”‚ â€¢ account_id (FK)â”‚â”€â”€â”€â”€â–º
â”‚ â€¢ type           â”‚         â”‚ â€¢ entry_type     â”‚         â”‚ â€¢ debit          â”‚
â”‚ â€¢ normal_balance â”‚         â”‚ â€¢ description    â”‚         â”‚ â€¢ credit         â”‚
â”‚ â€¢ is_cash_accountâ”‚         â”‚ â€¢ status         â”‚         â”‚ â€¢ description    â”‚
â”‚ â€¢ is_active      â”‚         â”‚ â€¢ photos         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                                      â”‚                              â”‚
                                      â”‚                              â”‚
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”        CONSTRAINT: â”‚
                             â”‚                 â”‚        debit = 0 OR â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” credit = 0  â”‚
                     â”‚   EXPENSES   â”‚  â”‚  SALARIES   â”‚ (not both)   â”‚
                     â”‚  (Metadata)  â”‚  â”‚  (Metadata) â”‚              â”‚
                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
                     â”‚ â€¢ id (PK)    â”‚  â”‚ â€¢ id (PK)   â”‚              â”‚
                     â”‚ â€¢ journal    â”‚  â”‚ â€¢ journal   â”‚              â”‚
                     â”‚   _entry_id  â”‚  â”‚   _entry_id â”‚              â”‚
                     â”‚ â€¢ category   â”‚  â”‚ â€¢ employee  â”‚              â”‚
                     â”‚ â€¢ paid_to    â”‚  â”‚   _name     â”‚              â”‚
                     â”‚ â€¢ expense    â”‚  â”‚ â€¢ base_sal  â”‚              â”‚
                     â”‚   _items     â”‚  â”‚ â€¢ allowance â”‚              â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                                                      â”‚
                             TRIGGER: check_journal_balance()         â”‚
                             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
                             Ensures: SUM(debit) = SUM(credit)        â”‚
                                      for each journal_entry          â”‚
```

---

## ğŸ”„ TRANSACTION FLOW DIAGRAM

### **Pengeluaran dari Kas Kecil**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER      â”‚
â”‚  (Frontend) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Fill Form
       â”‚    - Category: "Transport"
       â”‚    - Amount: 50,000
       â”‚    - From: Kas Kecil
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SUPABASE RPC FUNCTION                          â”‚
â”‚         create_expense_transaction()                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  BEGIN TRANSACTION                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â‘  Validate Amount > 0                                 â”‚  â”‚
â”‚  â”‚     âœ“ 50,000 > 0                                       â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â‘¡ Validate Account Exists                             â”‚  â”‚
â”‚  â”‚     âœ“ Kas Kecil (1101) found                           â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â‘¢ Check Balance (get_account_balance())               â”‚  â”‚
â”‚  â”‚     Current Balance: Rp 1,000,000                      â”‚  â”‚
â”‚  â”‚     Required: Rp 50,000                                â”‚  â”‚
â”‚  â”‚     âœ“ 1,000,000 >= 50,000 â†’ OK                         â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â‘£ Find Expense Account                                â”‚  â”‚
â”‚  â”‚     âœ“ Beban Transport (5102)                           â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â‘¤ INSERT journal_entries                              â”‚  â”‚
â”‚  â”‚     entry_number: EXP-20251215-000001                  â”‚  â”‚
â”‚  â”‚     entry_date: 2025-12-15                             â”‚  â”‚
â”‚  â”‚     entry_type: 'expense'                              â”‚  â”‚
â”‚  â”‚     description: "Pengeluaran Transport"               â”‚  â”‚
â”‚  â”‚     status: 'posted'                                   â”‚  â”‚
â”‚  â”‚     â†’ journal_entry_id: uuid-123                       â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â‘¥ INSERT journal_lines (Line 1)                       â”‚  â”‚
â”‚  â”‚     journal_entry_id: uuid-123                         â”‚  â”‚
â”‚  â”‚     account_id: 5102 (Beban Transport)                 â”‚  â”‚
â”‚  â”‚     debit: 50,000                                      â”‚  â”‚
â”‚  â”‚     credit: 0                                          â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â‘¦ INSERT journal_lines (Line 2)                       â”‚  â”‚
â”‚  â”‚     journal_entry_id: uuid-123                         â”‚  â”‚
â”‚  â”‚     account_id: 1101 (Kas Kecil)                       â”‚  â”‚
â”‚  â”‚     debit: 0                                           â”‚  â”‚
â”‚  â”‚     credit: 50,000                                     â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â‘§ TRIGGER check_journal_balance()                     â”‚  â”‚
â”‚  â”‚     Debit: 50,000                                      â”‚  â”‚
â”‚  â”‚     Credit: 50,000                                     â”‚  â”‚
â”‚  â”‚     âœ“ Balanced!                                        â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â‘¨ INSERT expenses (metadata)                          â”‚  â”‚
â”‚  â”‚     category: "Transport"                              â”‚  â”‚
â”‚  â”‚     paid_from_account_id: 1101                         â”‚  â”‚
â”‚  â”‚     â†’ expense_id: uuid-456                             â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  COMMIT                                                      â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ RETURN: expense_id
                            â”‚
                            â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   FRONTEND      â”‚
                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚ â‘  Get new       â”‚
                  â”‚   balance       â”‚
                  â”‚   950,000       â”‚
                  â”‚                 â”‚
                  â”‚ â‘¡ Show toast:   â”‚
                  â”‚   "âœ… Success!" â”‚
                  â”‚   Before: 1M    â”‚
                  â”‚   After: 950K   â”‚
                  â”‚                 â”‚
                  â”‚ â‘¢ Refresh list  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§® BALANCE CALCULATION FLOW

### **Cara Menghitung Saldo Kas Kecil**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         get_account_balance('1101', '2025-12-15')          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 1. Get Account Info        â”‚
        â”‚    - code: 1101            â”‚
        â”‚    - name: Kas Kecil       â”‚
        â”‚    - type: asset           â”‚
        â”‚    - normal_balance: debit â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 2. Query All Posted Journal Lines          â”‚
        â”‚    WHERE account_id = '1101'               â”‚
        â”‚      AND entry_date <= '2025-12-15'        â”‚
        â”‚      AND status = 'posted'                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 3. Sum Debits & Credits                    â”‚
        â”‚                                             â”‚
        â”‚    Date       | Entry      | Debit | Creditâ”‚
        â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚    2025-01-01 | Opening    | 1,000 | 0     â”‚
        â”‚    2025-01-05 | Transfer   | 500   | 0     â”‚
        â”‚    2025-01-10 | Expense    | 0     | 50    â”‚
        â”‚    2025-01-15 | Expense    | 0     | 100   â”‚
        â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚    TOTAL                   | 1,500 | 150   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 4. Calculate Balance                        â”‚
        â”‚                                             â”‚
        â”‚    normal_balance = 'debit'                â”‚
        â”‚    â†’ Formula: Debit - Credit                â”‚
        â”‚                                             â”‚
        â”‚    Balance = 1,500 - 150                    â”‚
        â”‚            = 1,350                          â”‚
        â”‚                                             â”‚
        â”‚    (Jika liability/revenue: Credit - Debit)â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  RETURN     â”‚
              â”‚  1,350      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” DATA CONSISTENCY GUARANTEES

### **ACID Properties**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ACID COMPLIANCE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ğŸ…°ï¸ ATOMICITY (All or Nothing)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â€¢ Supabase RPC functions wrapped in transaction               â”‚
â”‚  â€¢ If ANY step fails â†’ ROLLBACK entire transaction             â”‚
â”‚  â€¢ Example: If saldo check fails, NO data saved                â”‚
â”‚                                                                   â”‚
â”‚  âœ“ Cannot have: "expense saved but balance not updated"        â”‚
â”‚                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ğŸ…² CONSISTENCY (Rules Always Enforced)                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â€¢ Trigger: check_journal_balance()                             â”‚
â”‚    â†’ Ensures Debit = Credit for every entry                     â”‚
â”‚                                                                   â”‚
â”‚  â€¢ Constraint: debit = 0 OR credit = 0                          â”‚
â”‚    â†’ Cannot have both debit AND credit on same line             â”‚
â”‚                                                                   â”‚
â”‚  â€¢ CHECK constraints on amounts (>= 0)                          â”‚
â”‚                                                                   â”‚
â”‚  âœ“ Database REJECTS invalid data automatically                 â”‚
â”‚                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ğŸ…¸ ISOLATION (Concurrent Transactions Safe)                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â€¢ PostgreSQL handles lock automatically                        â”‚
â”‚  â€¢ User A's transaction doesn't interfere with User B's         â”‚
â”‚  â€¢ Row-level locking on journal entries                         â”‚
â”‚                                                                   â”‚
â”‚  âœ“ Safe for multiple users                                      â”‚
â”‚                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ğŸ…³ DURABILITY (Data Persists After Commit)                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â€¢ PostgreSQL WAL (Write-Ahead Logging)                         â”‚
â”‚  â€¢ Supabase automatic backups                                   â”‚
â”‚  â€¢ Data survives server crash/restart                           â”‚
â”‚                                                                   â”‚
â”‚  âœ“ Once committed, data is permanent                            â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ SINGLE SOURCE OF TRUTH

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘               SINGLE SOURCE OF TRUTH: journal_lines            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

         ALL BALANCES computed from journal_lines
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Saldo Kas    â”‚   â”‚ Total Beban  â”‚   â”‚ Laba/Rugi    â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
â”‚ = SUM(debit) â”‚   â”‚ = SUM(debit) â”‚   â”‚ = Revenue -  â”‚
â”‚   - SUM(cr)  â”‚   â”‚   for type   â”‚   â”‚   Expense    â”‚
â”‚   WHERE      â”‚   â”‚   'expense'  â”‚   â”‚              â”‚
â”‚   account =  â”‚   â”‚              â”‚   â”‚              â”‚
â”‚   '1101'     â”‚   â”‚              â”‚   â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… NO separate "balance" column to maintain
âœ… NO risk of "balance forgot to update"
âœ… ALWAYS accurate by definition

âŒ OLD WAY (Error-prone):
   expense_entries.amount â†’ manually update balance
   
âœ… NEW WAY (Bulletproof):
   journal_lines â†’ calculate balance on-the-fly
```

---

## ğŸ“ˆ REPORTING HIERARCHY

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REPORTING LAYER                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
        â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRIAL BALANCE    â”‚          â”‚  BALANCE SHEET   â”‚
â”‚                  â”‚          â”‚                  â”‚
â”‚ All accounts     â”‚          â”‚ â€¢ Assets         â”‚
â”‚ with debit/creditâ”‚          â”‚ â€¢ Liabilities    â”‚
â”‚ totals           â”‚          â”‚ â€¢ Equity         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                             â”‚
         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚     â”‚
         â–¼     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INCOME         â”‚
    â”‚ STATEMENT      â”‚
    â”‚                â”‚
    â”‚ â€¢ Revenue      â”‚
    â”‚ â€¢ Expenses     â”‚
    â”‚ â€¢ Net Income   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CASH FLOW     â”‚
    â”‚                â”‚
    â”‚ â€¢ Cash In      â”‚
    â”‚ â€¢ Cash Out     â”‚
    â”‚ â€¢ Net Change   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ALL computed from journal_lines in real-time
```

---

## ğŸ”„ ERROR HANDLING FLOW

```
USER ACTION: Submit Expense Rp 50,000 from Kas Kecil
â”‚
â”œâ”€ Current Balance: Rp 30,000 (insufficient!)
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase Function:                        â”‚
â”‚  create_expense_transaction()              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  BEGIN TRANSACTION                         â”‚
â”‚  â”‚                                          â”‚
â”‚  â”œâ”€ âœ“ Amount > 0                           â”‚
â”‚  â”œâ”€ âœ“ Account exists                       â”‚
â”‚  â”œâ”€ âŒ Balance check FAILS                 â”‚
â”‚  â”‚    30,000 < 50,000                      â”‚
â”‚  â”‚                                          â”‚
â”‚  â”‚    RAISE EXCEPTION:                     â”‚
â”‚  â”‚    "Insufficient balance.               â”‚
â”‚  â”‚     Current: Rp 30,000                  â”‚
â”‚  â”‚     Required: Rp 50,000"                â”‚
â”‚  â”‚                                          â”‚
â”‚  ROLLBACK (automatic)                      â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   FRONTEND   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ catch(error) â”‚
        â”‚ {            â”‚
        â”‚   alert(     â”‚
        â”‚     error    â”‚
        â”‚     .message â”‚
        â”‚   )          â”‚
        â”‚ }            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  USER SEES:                   â”‚
        â”‚  âŒ Saldo tidak cukup!        â”‚
        â”‚                               â”‚
        â”‚  Saldo: Rp 30,000             â”‚
        â”‚  Dibutuhkan: Rp 50,000        â”‚
        â”‚                               â”‚
        â”‚  [OK]                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… NO data saved
âœ… Balance unchanged
âœ… User informed clearly
```

---

## ğŸ¯ SUMMARY

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          KEY PRINCIPLES OF THIS ARCHITECTURE                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                 â•‘
â•‘  1ï¸âƒ£ SINGLE SOURCE OF TRUTH                                     â•‘
â•‘     â†’ All balances from journal_lines                          â•‘
â•‘                                                                 â•‘
â•‘  2ï¸âƒ£ ATOMIC TRANSACTIONS                                        â•‘
â•‘     â†’ All-or-nothing, no partial saves                         â•‘
â•‘                                                                 â•‘
â•‘  3ï¸âƒ£ AUTOMATIC VALIDATION                                       â•‘
â•‘     â†’ Triggers enforce debit = credit                          â•‘
â•‘                                                                 â•‘
â•‘  4ï¸âƒ£ IMMUTABLE RECORDS                                          â•‘
â•‘     â†’ Posted entries cannot be edited (only voided)            â•‘
â•‘                                                                 â•‘
â•‘  5ï¸âƒ£ CLEAR AUDIT TRAIL                                          â•‘
â•‘     â†’ Every change tracked in journal                          â•‘
â•‘                                                                 â•‘
â•‘  6ï¸âƒ£ REAL-TIME ACCURACY                                         â•‘
â•‘     â†’ Balance computed on-the-fly, always current              â•‘
â•‘                                                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```
